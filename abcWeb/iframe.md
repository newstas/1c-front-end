# iframe — встроенная страница

`<iframe>` — это контейнер, который позволяет вставить любой HTML-документ из другого источника. Часто этот документ интерактивный — например, карта, видео или пост из соцсети.

Этот контейнер обычно называют фреймом. Внешний вид фрейма и его положение на странице можно задать через CSS.

Тег `<iframe>` позволяет встраивать контент (например, веб-страницы, видео) прямо в ваш документ HTML.

**Простейший пример** использования `<iframe>`:

```
<iframe src="https://example.com" width="600" height="400"></iframe>
```

**Еще пример**. С помощью такого нехитрого кода мы можем встроить карту размером 560 на 400 пикселей на любую страницу:
```
<iframe
  id="inlineFrameExample"
  title="Inline Frame Map"
  width="560"
  height="400"
  frameborder="1"
  allowfullscreen="true"
  src="https://yandex.ru/map-widget/v1/-/CBFkaYSE0A"
>
</iframe>
```

Атрибут `src` задаёт URL-адрес страницы, которую вы хотите встроить.

Атрибуты `width` и `height` — ширина и высота фрейма (можно задавать как в пикселях, так и в процентах).

### Как понять

`<iframe>` можно представить как «окно» или фрейм, через которое на вашей странице можно увидеть любое содержимое с других сайтов. Это значит, что если карту, видео, пост или другой элемент удалят с оригинального сайта, он пропадёт и с вашей страницы. Останется только пустое место или надпись вроде «Контент недоступен».

Встраивать файлы можно либо по ссылке с помощью атрибута `src`, либо целиком HTML-код файла с помощью `srcdoc`.


## Все атрибуты

`src` — URL-адрес файла, который вы встраиваете.

`srcdoc` — позволяет встроить HTML-код целиком, так что браузеру не придётся подгружать что-то по внешней ссылке. Если используется этот атрибут, то ссылка `src` игнорируется.

`sandbox`

`sandbox` — ограничивает определённые действия и функции встраиваемого документа. Это важный атрибут с точки зрения безопасности. Он позволяет контролировать, какие активности разрешены внутри `<iframe>`. 

Возможные значечения атрибута `sandbox`:
- `allow-forms` — позволяет отправлять формы внутри <iframe>.
- `allow-modals` — позволяет открывать модальные окна, которые мы все так не любим: вроде «Оставьте свой имейл» или «Не уходите так быстро! У вас товар в корзине». Обычно эти окна не дают пользоваться сайтом, пока их не закроешь.
- `allow-orientation-lock` — позволяет фиксировать горизонтальное или вертикальное положение экрана.
- `allow-pointer-lock` — позволяет (**сюрприз!**) блокировать указатель; позволяет пользователю управлять содержимым <iframe> с помощью курсора через Pointer Lock API.
- `allow-popups` — разрешает (**шок!**) показ всплывающих окон, вызванных с помощью window.open(), target="_blank" или showModalDialog().
- `allow-popups-to-escape-sandbox` — позволяет содержимому фрейма открывать новые окна. С этим параметром у таких окон не будет тех ограничений, которые есть у <iframe> с атрибутом sandbox.
- `allow-presentation` — разрешает использовать Presentation API.
- `allow-same-origin` — контент из <iframe> загружается по тем же правилам и с теми же ограничениями, что и страница, на которой он находится.
- `allow-scripts` — позволяет загружать скрипты. При этом всплывающие окна будут запрещены.
- `allow-top-navigation` — позволяет открывать ссылки, которые есть в <iframe>, в том же окне, в которое встроен фрейм.
- `allow-top-navigation-by-user-activation` — позволяет контенту из фрейма управлять страницей, на которой он находится. Но только по инициативе пользователя.

Если просто указать атрибут sandbox, то он применит сразу все возможные ограничения. Либо можно указать нужные ограничения в любом порядке через пробел:

`<iframe src="https://example.com" sandbox="allow-scripts allow-same-origin"></iframe>`

Значение allow-scripts разрешает выполнение скриптов внутри фрейма, а allow-same-origin позволяет фрейму обращаться к ресурсам его исходной страницы.

> Элементы `iframe` — это первый шаг к созданию хорошей структуры. Загрузка ненадежного компонента в `iframe` **обеспечивает определенную степень разделения между вашим приложением и содержимым,** которое вы хотите загрузить. **Содержимое в рамке не будет иметь доступа к DOM вашей страницы или данным**, которые вы сохранили локально, а также не сможет рисоваться в произвольных позициях на странице; его объем ограничен контуром кадра. Однако разделение не является действительно надежным. Содержимая страница **по-прежнему имеет ряд возможностей для раздражающего или вредоносного поведения**: *автоматическое воспроизведение видео, плагины и всплывающие окна* — это верхушка айсберга.

> Атрибут sandbox элемента `iframe` дает нам именно то, что нам нужно, **чтобы ужесточить ограничения на контент в фреймах**. Мы можем поручить браузеру загружать содержимое определенного фрейма в среде с низким уровнем привилегий, разрешая только подмножество возможностей, необходимых для выполнения любой работы.


`loading`

Атрибут loading может помочь с оптимизацией производительности и отложить загрузку iframe до тех пор, пока это не будет необходимо.

`<iframe src="https://example.com" loading="lazy"></iframe>`


`allowfullscreen, allowpaymentrequest`

Здесь всё просто и следует из названия:
- `allowfullscreen`: позволяет встроенному контенту открываться в полноэкранном режиме.
- `allowpaymentrequest`: позволяет встроенному контенту делать запросы на оплату.
    

`title`

Не забывайте об универсальных атрибутах, таких как `title`, которые способствуют улучшению доступности.

`<iframe src="https://example.com" title="Example Content"></iframe>`


`name`

`name` — имя фрейма. Пригодится, чтобы создать ссылку, по которой новая страница будет открываться в нужном фрейме.


## Стилизация

`<iframe>` можно стилизовать, как и любой другой элемент. Но помните, что стили вашей родительской страницы не применяются к содержимому `<iframe>`, и вы не сможете его стилизовать через CSS в родительском документе.
```
iframe {
  border: none; 
}
```

## Отслеживание событий загрузки

Вы можете отслеживать событие load для <iframe>, чтобы знать, когда встроенный контент загружен.
```
document.querySelector('iframe').addEventListener('load', function() {
  console.log('Iframe is loaded!'); 
});
```


# `src` и `srcdoc` в `iframe` HTML5: разница и применение

Атрибут `srcdoc` позволяет непосредственно встраивать HTML-содержимое в `<iframe>`, делая код более читаемым и интуитивным. 
В то же время атрибут src, использующий **Data URI**, требует преобразования HTML в формат URL, что может быть неудобно, 
особенно при работе с большими объемами данных. Использование `srcdoc` упрощает процесс и обеспечивает лучшую читаемость 
встроенного кода:

`srcdoc` пример использования:
```html
<iframe srcdoc="<p>Привет, мир!</p>"></iframe>
```

**Data URI** пример использования:
```html
<iframe src="data:text/html,<p>Привет, мир!</p>"></iframe>
```

Оба способа позволяют выводить текст "Привет, мир!" в `<iframe>`, однако `srcdoc` делает этот процесс более прямым 
и удобным для работы с HTML-контентом внутри `iframe`.


## Навигация по безопасности

Когда дело доходит до работы с ненадежным содержимым, srcdoc можно использовать в сочетании с атрибутом `sandbox` 
для обеспечения безопасности внутреннего содержимого. Стоит отметить, что поддержка srcdoc в старых браузерах может быть ограничена. 
Если для `<iframe>` заданы одновременно и `src`, и `srcdoc`, **преференция будет отдана `srcdoc`**, исключая запросы к внешним ресурсам.

Если вы используете **Internet Explorer 11, то `srcdoc` не будет поддерживаться**. Современные браузеры хорошо 
работают с `srcdoc`, делая его более безопасным для инлайн-содержимого. Тем не менее, использование `src` с **Data URI** 
может привлечь внимание злоумышленников, а также существуют ограничения на длину URL.


## Глубина содержимого – продвинутое управление

### Бесшовная интеграция и обход междоменных ограничений

`srcdoc` обеспечивает более плавное и прозрачное встраивание HTML-кода, исключая сложности с кодированием 
и увеличивая читабельность содержимого. Это позволяет создавать полноценные HTML-структуры внутри `<iframe>`, 
контролируя междоменные ограничения, которые могут возникнуть при использовании `src` с **Data URI**:

Пример использования `srcdoc` для встраивания:
```html
<iframe srcdoc="<style>h2 {color: red;}</style><h2>Стилизованный контент</h2>"></iframe>
```

### Работа с куками

Для `iframe` взаимодействие с куками может быть сложной задачей. Однако, `srcdoc` значительно облегчает этот процесс, 
предоставляя устойчивый контроль над куками. Использование `src` с **Data URI** требует учета ограничений по использованию кук 
в различных доменах, в то время как srcdoc является более надежным вариантом, работающим в рамках одного источника.

### Особенности браузеров

Важно учесть различия в поддержке `srcdoc` в разных браузерах, поскольку каждый из них может внести свои коррективы 
в работу с этим атрибутом. Например, Chrome работает с куками по-своему, и подход `srcdoc` приспосабливается к этой особенности. 
С другой стороны, использование src может столкнуться с особыми ограничениями браузера, такими как пределы длины URL и другие "тонкости".


## Не поддерживается браузером? Есть альтернативы

Если вам приходится работать со старыми браузерами, которые не поддерживают `srcdoc`, можно использовать методы передачи 
структурированных данных, такие как `postMessage` или серверные решения. Хотя они могут быть более сложными, 
они обеспечивают безопасность и возможность взаимодействия.

> Если браузер НЕ поддерживает атрибут `srcdoc`, вместо него будет отображаться файл, указанный в атрибуте `src` (если он присутствует).


## Визуализация

`srcdoc` и `src` с **Data URI** в `<iframe>` можно представить как два разных способа упаковки багажа:

| Метод       | Техника упаковки багажа               | Описание                                         |
| --------------- | --------------------------------- |-------------------------------------------------|
| `srcdoc`        | Прямая упаковка                  | Предметы укладываются напрямую в чемодан      |
| `src=data`      | Упакованный чемодан               | Вставка уже упакованного чемодана в другой  |

Прямая упаковка `srcdoc` — объекты помещаются прямо в чемодан `iframe`:
```html
<iframe srcdoc="<p>Привет, inline!</p>"></iframe> // Мы прямо укладываем <p> в чемодан (iframe)
```

Упакованный чемодан `src=data` — чемодан уже упакован и помещается в другой:
```html
<iframe src="data:text/html;base64,PGgxPkhlbGxvLCBkYXRhIFVSSSE8L2gxPg=="></iframe> // Мы вкладываем упакованный объект (data URI) в большой чемодан
```

### Подход для больших объемов данных

Для работы с большим объемом HTML-содержимого рекомендуется предпочесть использование `srcdoc` вместо `src` с **Data URI**, 
чтобы избежать перегруженности атрибута. srcdoc является более эффективным выбором, потому что он отключает необходимость кодирования 
и декодирования больших объемов данных.

### Быстрая загрузка и пользовательский опыт

Содержимое, внедренное через `srcdoc`, загружается в процессе основной загрузки страницы, что **может улучшить показатели 
скорости загрузки**. Используйте `srcdoc` для ускорения загрузки встроенного контента и улучшения пользовательского опыта.
Обслуживание и поддержка

Отладка и поддержка становятся проще при использовании `srcdoc`, поскольку разработчики могут напрямую редактировать HTML 
непосредственно в родительском документе. Это облегчает рабочий процесс и способствует более плавному циклу разработки 
по сравнению с работой с заранее закодированными **data URI**.



### Полезные ссылки

[Спецификация](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element)

[Дока iframe](https://doka.guide/html/iframe/)

[Доктайп iframe](https://htmlacademy.ru/blog/html-tags/iframe)

